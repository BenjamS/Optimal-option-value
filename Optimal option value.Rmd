---
title: Improvement-maximizing real option value
author:
  - name: Benjamin Schiek
    email: b.schiek@cgiar.org
    affiliation: CIAT
    footnote: 1
address:
  - code: CIAT
    address: Alliance of Bioversity International and CIAT, Km 17 Recta Cali-Palmira, Valle del Cauca, Colombia, CP 763537
footnote:
  - code: 1
    text: "Corresponding Author"
abstract: |
  I derive the necessary and sufficient conditions for optimal value of a real option with lognormally distributed net present value. The solution is optimal in the sense that it maximizes the option's improvement---that is to say, the increase in the option's value between inception and maturity. An expression for optimal net present option value, as well as equations by which to solve for optimizing parameter values, follow as corrollaries. The expression for optimized real option value is considerably simpler than the unoptimized expression, potentially facilitating real option funding decision workflows.

journal: "Research Policy"
date: "`r Sys.Date()`"
bibliography: Optimal option value.bib
header-includes:
  - \numberwithin{equation}{section}
#linenumbers: true
#numbersections: true
csl: elsevier-harvard.csl
output: rticles::elsevier_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      dev = c("png", "tiff"),
                      dpi = 300)
library(tidyverse)

label_size <- 2.5
smallLabel_size <- 2
title_size <- 8
subtitle_size <- 7
legendText_size <- 7
axisText_size <- 6
axisTitle_size <- 7
facetTitle_size <- 7

```


# Introduction

In this article, I derive the necessary and sufficient conditions to maximize improvement in the real option value $f$ of a project with lognormally distributed net present value $x$ over the life of the project, from inception at $t = 0$ to maturity at $t = T$. In other words, I find the solution $f^*$ that maximizes the definite integral

\begin{equation}
\int_0^T \frac{df}{dt} \:dt = f(T) - f(0)
\end{equation}

To derive the sufficient condition, I draw on a famous insight of Black and Scholes' in order to reduce the necessary condition to a wave equation, which is then solved using D'Alambert's formula. The optimized (i.e. improvement maximizing) expression $f^*$ then follows by evaluating the Black-Scholes partial differential equation at the necessary condition, resulting in a second wave equation again soluble via D'Alambert's formula.
<!-- [Assuming maximum improvement is desirable, the solution $f^*$ provides a pragmatic reference point against which to compare real option value. A donor or manager may think twice about investing in a project if its real option value diverges substantially from the optimal value $f^*$.] -->

In decision making contexts where the practitioner has discretion over one or more of the arguments of $f$, the optimized expression $f^*$ can be used to solve for their optimal value(s). Still more appealing to the practitioner, perhaps, is that the functional form of $f^*$ is considerably simpler than the unoptimized form $f$, potentially facilitating ROV workflows.

Before embarking upon the main derivation, it is first necessary to explain exactly what is meant by real option value, and to clear up some confusion regarding the validity of "risk-neutral valuation" in real options contexts.
<!-- [I begin by clarifying exactly what I mean by real option value. I highlight engage with the key literature re:complexity as a problem. To motivate interest in the simplicity, I point to the key sources of complexity... The results presented here rest upon the key assumption of lognormally distributed NPV, which is widely eschewed in the ROV literature as unrealistic. I therefore begin with a brief defense of this assumption.] -->

## What is real option value?

In the default approach to project funding decisions, the net present value (NPV) of the project's future impacts is compared against the investment required to implement the project. If the NPV (also sometimes referred to as discounted future cash flow) is less than the investment, then the project proposal is rejected. In other words, letting $x_0$ represent project NPV as evaluated at time $t = 0$ (the start of the project) and $I$ the required investment,

\begin{equation}
x_0 < I \:\: \rightarrow \:\: \text{reject project}
\end{equation}

However, oftentimes the investment $I$ can be decomposed into an upfront sunk cost $S$ required to initiate and sustain project activities, and a subsequent outlay $K$ required a considerable time later, after certain intermediate project goals have been met. The decision criterion can thus more realistically be written as follows.

\begin{equation}
e^{-rT} (E[x_T] - K) < S \:\: \rightarrow \:\: \text{reject project}
\label{eq:npvIneq1}
\end{equation}

Where $r$ is the discount rate, and $T$ the time at which the subsequent outlay $K$ is required (usually the same as the project time horizon).

If $x_t$ $(0 < t \leq T)$ follows a geometric Brownian motion described by the equation

\begin{equation}
\begin{split}
\Delta x_t &= x_{t + \Delta t} - x_t \\
&= m x_t \Delta t + s x_t \epsilon \sqrt{\Delta t}
\end{split}
\label{eq:gbmEq}
\end{equation}

Where $\epsilon$ is a normally distributed random variable with mean $0$ and variance $1$, such that

\begin{equation}
\begin{split}
m \tau &= E[\frac{\Delta x_t}{x_t}] \\
s^2 \tau &= Var[\frac{\Delta x_t}{x_t}]
\end{split}
\end{equation}

Then $E[x_T]\bigr|_{t = 0} = x_0 e^{m T}$ (see Hull [-@hull9thEdition] for details); and inequality \ref{eq:npvIneq1} simplifies as follows.

\begin{equation}
e^{m - rT} x_0 - e^{-rT} K < S \:\: \rightarrow \:\: \text{reject project}
\label{eq:npvIneq2}
\end{equation}

Moreover, project managers and stakeholders usually have the option to cancel the subsequent outlay $K$ if critical intermediate project goals are not met. That is, they can choose to cancel the outlay if the NPV evaluated at time $T$ is less than the outlay $K$. The decision criterion may thus be expressed even more realistically as follows.

\begin{equation}
e^{-rT} E[max(x_T - K, 0)] < S \:\: \rightarrow \:\: \text{reject project}
\end{equation}

The left hand side of this inequality is often called the "real option value", because it is analogous to the value of a European call option in financial markets. This term was first coined by Myers [-@myers1977determinants], and the real options literature has since become vast. See Trigeorgis [-@trigeorgis1993real], [], and references for introductions, extensions and variations.

If $x_t$ follows the geometric Brownian motion described above, then it can be shown by straightforward integration that the real option value (ROV) evaluated at some time $t = \hat{t}$ has the following closed form expression.

\begin{equation}
e^{-r\tau} E[max(x_{\tau} - K, 0)]\bigr|_{\hat{t}} = e^{(m - r) \tau} x_{\hat{t}} \Phi(\delta + s \sqrt{\tau}) - e^{-r tau} K \Phi(\delta)
\label{eq:rov}
\end{equation}

Where $x_{\hat{t}}$ is the project NPV estimated at time $t  = \hat{t}$, $\tau = T - \hat{t}$, $\Phi()$ is the standard normal cumulative distribution function, and where

\begin{equation}
\delta = \frac{\ln (x_t / K) + (m - s^2 / 2) \tau}{s \sqrt{\tau}}
\end{equation}

See Appendix for proof.

To build intuition, it is instructive to graph ROV (equation \ref{eq:rov}) against NPV (lefthand side of inequality \ref{eq:npvIneq2}). An example is given in Figure \ref{fig:rovIllust}. Note that ROV differs from NPV only over sufficiently large outlays $K$. Note also that, the smaller the uncertainty $s$, the smaller the range of $K$ over which there is a significant difference.

```{r Fig1, fig.show = "hold", fig.width = 3, fig.height=3, fig.align="center", fig.cap="\\label{fig:rovIllust}A hypothetical project's real option value and net present value plotted together over a range of outlays $K$. The black line marks 0, while the dotted red line marks the sunk cost $S$ beneath which the project is rejected. The multiple ROV plots correspond to different levels of uncertainty (s). The higher the uncertainty, the greater the difference between ROV and NPV.", echo = FALSE}


OVfun <- function(X0, K, tau, mm, s, r, output = "OV"){
  
  d2 <- (log(X0 / K) + (mm - s^2 / 2) * tau) / (s * sqrt(tau))
  d1 <- d2 + s * sqrt(tau)
  N1 <- pnorm(d1)
  N2 <- pnorm(d2)
  
  OV <- exp((mm - r) * tau) * X0 * N1 - exp(-r * tau) * K * N2

    if(output == "OV"){
    out <- OV
  }
  
  if(output == "N2"){
    out <- N2
  }
  
  if(output == "N1"){
    out <- N1
  }

  return(out)
}
#===========================================================================
mm <- 0.02
r <- mm
cv <- seq(1, 6, length.out = 3)
s <- round(cv * mm, 2)
X0 <- 10
tau <- 35
K <- seq(0.1, 3, length.out = 20) * X0
NPV <- X0 - exp(-r * tau) * K
ns <- length(cv)
list_df <- list()
for(i in 1:ns){
  this_s <- s[i]
  ROV <- OVfun(X0, K, tau, mm, this_s, r, output = "OV")
  df <- data.frame(K, cv = as.character(cv[i]), ROV, NPV)
  list_df[[i]] <- df
}

df_plot <- as.data.frame(do.call(rbind, list_df))
df_plot1 <- subset(df_plot, cv == cv[length(cv)])
df_plot1$cv <- NULL
df_plot1 <- df_plot1 %>% gather(type, Value, ROV:NPV)
df_plot2 <- subset(df_plot, cv != cv[length(cv)])

n <- length(unique(df_plot1$type))
bag_of_colors <- randomcoloR::distinctColorPalette(k = 2 * n)
color_vec <- sample(bag_of_colors, n)

gg <- ggplot()
gg <- gg + geom_line(data = df_plot2, aes(x = K, y = ROV,
                                         group = cv),
                     color = color_vec[2], lwd = 1)
gg <- gg + geom_line(data = df_plot1, aes(x = K, y = Value,
                                          group = type, color = type),
                     lwd = 1)
gg <- gg + scale_color_manual(values = color_vec)
gg <- gg + labs(y = "Value")
gg <- gg + geom_hline(yintercept = 2, color = "red", linetype = "dashed")
gg <- gg + geom_hline(yintercept = 0)
gg <- gg + theme_bw()
gg <- gg + theme(axis.text = element_blank(),
                 axis.title = element_text(size = axisTitle_size),
                 legend.title = element_blank(),
                 legend.position = "top",
                 legend.text = element_text(size = legendText_size))
gg


```

Despite a flood of academic interest in ROV following Myers' initial insight (see, for example, Hayes and Garvin [-@hayes1982managing], McGrath and MacMillan [-@mcgrath2000assessing], Doctor, Newton, and Pearson [-@doctor2001managing], and Newton, Paxson, and Widdicks [-@newton2004real]), adoption of the real options approach by real world decision makers remains relatively low [@horn2015use; @triantis2005realizing; @driouchi2012real]. ROV critics and proponents alike attribute this tepid reception to the formal complexity of evaluating and explaining ROV as compared to the default NPV approach [@triantis2005realizing]. Much of this complexity can be traced back to confusion surrounding the interpretation of a financial artifact called "risk-neutral valuation" in ROV contexts.

## Confusion regarding "risk-neutral valuation" in ROV contexts

The derivation of equation \ref{eq:rov} via the method of straightforward integration, as presented in the Appendix, is atypical of the ROV literature. Most authors instead cite the Black-Scholes partial differentiation equation as the source of the ROV formula [@black1973valuation]. The method of straightforward integration is considerably simpler than the Black-Scholes approach. In financial contexts, the Black-Scholes approach is advantageous because it generates a whole class of functional forms known as "financial derivatives", of which the European call option formula is just one.

More importantly, the Black-Scholes approach reveals, as a by-product, a deep result known as the principle of "risk-neutral valuation": If it is not possible to make risk-free profits above the risk-free rate of return (the "no-arbitrage" rule), then investors are risk-neutral, i.e. "investors do not increase the expected return they require from an investment in order to compensate for increased risk" [@hull9thEdition]. Mathematically, this means that the $m$ in equation \ref{eq:rov} must be set equal to $r$^[Where $r$, in financial contexts, refers to the risk-free rate of return]. (Details given in the next section.)

The principle of risk-neutral valuation rests squarely upon the no-arbitrage rule, which is enforced through the market. This is fine in financial markets. However, in the ROV context, there is no clear theoretical or empirical basis for the no-arbitrage rule. Real project NPV is not a traded good, and there is no clear mechanism that might serve as a market analogue. On the contrary, most ROV contexts may be characterized as far-from-market---or even market failures, which the underlying project is supposed to redress. Empirically, it is a matter of public knowledge that project donors and managers are generally not risk-neutral; i.e., they would require an increase in expected project NPV to justify funding for a project with increased risk.

Critics note that the ROV literature is silent and/or conflicted on this point [@borison2005real; @block2007real]. It is not uncommon for ROV studies, and even ROV introductory texts, to assume risk-neutral valuation without any justification (see, for example, Trigeorgis [-@trigeorgis1993real], Majd and Pindyck [-@majd1987time], or Kemna [-@kemna1993case]). Some studies acknowledge the invalidity of the no-arbitrage argument in ROV contexts, but instead invoke "complete markets" to justify risk-neutral valuation (see, for example, Pennings and Lint [-@pennings1997option]). The complete markets assumption implies that 1) project NPV can be simulated by a portfolio of traded securities, and hence project risk can be hedged away by buying and/or selling these traded securities; and 2) project managers actually engage in the buying and selling of securities necessary to achieve this hedge. One may say without controversy that neither (1) nor (2) are common features of most far-from-market project management landscapes.

Mathematically, the absence of any empirical or theoretical premise for risk-neutral valuation in ROV contexts means that there is no reason to set $m$ in equation \ref{eq:rov} equal to $r$. This deceptively minute detail figures critically in the derivation of the necessary and sufficient conditions for improvement maximizing ROV.
<!-- ## Low adoption of the ROV approach -->
<!-- Despite a flood of academic enthusiasm and interest in ROV following Myers' initial insight (see, for example, Hayes and Garvin [-@hayes1982managing], McGrath and MacMillan [-@mcgrath2000assessing], Doctor, Newton, and Pearson [-@doctor2001managing], and Newton, Paxson, and Widdicks [-@newton2004real]), adoption of the real options approach by real world decision makers remains relatively low [@horn2015use; @triantis2005realizing; @driouchi2012real]. ROV critics and proponents alike attribute the tepid reception among practitioners to the formal complexity of evaluating and explaining ROV as compared to the default NPV approach [@triantis2005realizing]. -->
<!-- Much of this complexity can be traced back to two sources. First of all, many reject of the NPV lognormality assumption used to derive the closed form expression above. Pennings and Lint [-@pennings1997option], for example, observe that changes in project NPV generally do not occur in every time step, and implement a compound Poisson (CP) model to more accurately reflect this reality. Unfortunately, this increment in realism comes at the heavy cost of requiring numerical methods that are considerably less tractable and transparent. Trigeorgis calls such methods an unavoidable "bitter pill" that all serious ROV practitioners must take [-@trigeorgis1993real]. -->
<!-- Secondly, critics note that much of the ROV literature is silent and/or conflicted regarding the translation of the efficient market (or "no arbitrage") hypothesis in the often far-from-market contexts of real project management [@borison2005real; @block2007real]. In financial contexts, the no arbitrage argument results in a  -->
<!-- [However, the question of where ... must be assessed on a case by case basis. is a matter of preference. In academic contexts, there is a premium on rigor and realism. Most real options settings, on the other hand, time, resources, patience, and attention-span are in relatively short supply ... there is a premium on transparency, expediency. Pennings and Lint use equation \ref{eq:rov} and find that the numerical method output differs by just x%. That is a lot of extra work for a negligible difference. Whether or not changes occur in every time step is a matter of judicious choice of time step. In most real options settings, changes might not occur every day or every week or even every month, but probably do occur at least once every quarter. Moreover, such meticulous realism quickly lands the practitioner in other problems. In most real options settings, the research, analysis, and reporting protocols by which new information affecting project NPV becomes available occur at predetermined, non-random intervals, whereas the CP model is only valid for events occurring at random intervals. The order of changes in NPV is irrelevant. It is the size distribution of changes that matters, not when they occur. The frequency domain is what matters, not the time evolution.] -->
<!-- # It's ok to be lognormal -->
<!-- When taking a real options approach to project evaluation, it becomes necessary to think carefully about the evolution of project NPV over the life of the project. -->
<!-- Many consider the assumption of lognormally distributed NPV unrealistic. This is to some degree rooted in the original financial context, where the assumption of lognormal security returns is widely viewed as naive... -->
<!-- Bibby and Sorensen [@bibby1996hyperbolic] -->
<!-- Pennings and Lint []. .  misconception [Tankov]. -->

# Maximum ROV improvement

Henceforth, let $ROV$ be denoted by $f$. A practitioner may be interested in maximizing the improvement in ROV over the project timeline. That is, they may want to maximize

\begin{equation}
f(T) - f(0)
\end{equation}

which can also be written

\begin{equation}
\int^{T}_0 \frac{df}{dt} \:dt
\label{eq:action}
\end{equation}

Letting $\mathcal{L} = \frac{df}{dt}$, the necessary condition for maximizing this definite integral is called Euler's condition:

\begin{equation}
\frac{\partial \mathcal{L}}{\partial x} = \frac{d}{dt} \left( \frac{\partial \mathcal{L}}{\partial \dot{x}} \right)
\label{eq:eulCond}
\end{equation}

(See Lebedev and Cloud [-@lebedev2003calculus] for details.)

## The non-market Black-Scholes PDE

Continuing with the assumption that $x_t$ follows a geometric Brownian motion, then, by Ito's lemma, the evolution of a function $f(x_t)$ is described as follows.

\begin{equation}
\Delta f = \left( \frac{\partial f}{\partial x} m x + \frac{\partial f}{\partial t} + \frac{1}{2} \frac{\partial^2 f}{\partial x^2} s^2 x^2 \right) \Delta t + \frac{\partial f}{\partial x} s x \epsilon \sqrt{\Delta t}
\label{eq:itoLem}
\end{equation}

(See Hull [-@hull9thEdition] for details.)

Black and Scholes [-@black1973valuation] famously noted that equations \ref{eq:gbmEq} and \ref{eq:itoLem} could be combined so as to eliminate the random term as follows.

\begin{equation}
\Delta f - \frac{\partial f}{\partial x} \Delta x = \left(\frac{\partial f}{\partial t} + \frac{1}{2} \frac{\partial^2 f}{\partial x^2} s^2 x^2 \right) \Delta t
\label{eq:bsInsight1}
\end{equation}

This is where Black and Scholes apply their no-arbitrage argument. In the financial context, the lefthand side of this equation may be thought of as the instantaneous evolution over the increment $\Delta t$ of a portfolio long one share of the financial derivative $f$ and short a quantity $\partial f / \partial x$ of the underlying security $x_t$. Black and Scholes reasoned that, since the random---i.e. risky---term has been eliminated from equation \ref{eq:bsInsight1}, then the profit or loss of this portfolio over the increment $\Delta t$ must be riskless. That is,

\begin{equation}
\Delta f - \frac{\partial f}{\partial x} \Delta x = \left( f - \frac{\partial f}{\partial x} x \right) r \Delta t
\end{equation}

Where $r$ is the risk-free rate of return. Equating the righthand side of this equation with the righthand side of the previous equation, the $\Delta t$'s cancel, resulting in the Black-Scholes partial differentiation equation (PDE).

\begin{equation}
\left( f - \frac{\partial f}{\partial x} x \right) r = \frac{\partial f}{\partial t} + \frac{1}{2} \frac{\partial^2 f}{\partial x^2} s^2 x^2 \end{equation}

Black and Scholes solved this PDE under the boundary condition $f(T) = \max(x_T - K, 0)$, resulting in an expression for $f$ identical to the one derived above in equation \ref{eq:rov}, _with the exception_ that $m$ is replaced with $r$.

But Black and Scholes' insight can be decomposed into two consecutive insights. The first insight is that, having eliminated the random terms in equation \ref{eq:bsInsight1}, the now deterministic equation implies the evolution of the lefthand side must be constant over the interval $\Delta t$. This means the lefthand side of equation \ref{eq:bsInsight1} may be written in terms of a time evolution, as follows.

\begin{equation}
\Delta f - \frac{\partial f}{\partial x} \Delta x = \left( f - \frac{\partial f}{\partial x} x \right) \kappa \Delta t
\end{equation}

Where $\kappa$ is some constant with respect to the interval $\Delta t$.

The second insight is about resolving the value of $\kappa$. In financial markets, the no-arbitrage rule requires that $\kappa = r$. In the absence of the no-arbitrage rule, however, the $r$ in the Black-Scholes PDE must be replaced by $\kappa$. Moreover, solving this non-market version of the Black-Scholes PDE under the boundary condition $f(T) = \max(x_T - K, 0)$ \ref{eq:rov}, and comparing it to equation \ref{eq:rov}, then reveals that $\kappa = m$. In the absence of the no-arbitrage rule, then, the Black-Scholes PDE must default to

\begin{equation}
\left( f - \frac{\partial f}{\partial x} x \right) m = \frac{\partial f}{\partial t} + \frac{1}{2} \frac{\partial^2 f}{\partial x^2} s^2 x^2 \end{equation}

This is the Black-Scholes PDE of relevance in far-from-market ROV contexts.

## Necessary condition

The total derivative in equation \ref{eq:bsInsight1} can be expressed as follows.

\begin{equation}
\frac{df}{dt} = \frac{\partial f}{\partial x} \dot{x} + \frac{\partial f}{\partial t} + \frac{s^2 x^2}{2} \frac{\partial^2 f}{\partial x^2} \:\:;\:\:\: \dot{x} = \frac{dx}{dt}
\label{eq:lagrang}
\end{equation}

Black and Scholes' insight thus yields a lagrangian $\mathcal{L}$ that can be fed into the Euler condition (equation \ref{eq:eulCond}).

The lefthand side of the Euler condition thus becomes

\begin{equation}
\frac{\partial \mathcal{L}}{\partial x} = \frac{\partial^2 f}{\partial x^2} \dot{x} + \frac{\partial}{\partial x} \left( \frac{\partial f}{\partial t} \right) + \frac{s^2}{2} \frac{\partial}{\partial x} \left(x^2 \frac{\partial^2 f}{\partial x^2} \right) 
\end{equation}

The righthand side of the Euler condition, meanwhile, resolves as follows.

\begin{equation}
\frac{\partial \mathcal{L}}{\partial \dot{x}} = \frac{\partial f}{\partial x}
\end{equation}

And so

\begin{equation}
\frac{d}{dt}\left(\frac{\partial \mathcal{L}}{\partial \dot{x}}\right) = \frac{\partial }{\partial t} \left( \frac{\partial f}{\partial x} \right) + \frac{\partial^2 f}{\partial x^2} \dot{x}
\end{equation}

Equating the two sides of the Euler condition and simplifying,

\begin{equation}
\begin{split}
\frac{\partial^2 f}{\partial x^2} \dot{x} + \frac{\partial}{\partial x} \left( \frac{\partial f}{\partial t} \right) + \frac{s^2}{2} \frac{\partial}{\partial x} \left(x^2 \frac{\partial^2 f}{\partial x^2} \right) = \frac{\partial }{\partial t} \left( \frac{\partial f}{\partial x} \right) + \frac{\partial^2 f}{\partial x^2} \dot{x} \\
\frac{\partial}{\partial x} \left( \frac{\partial f}{\partial t} \right) + \frac{s^2}{2} \frac{\partial}{\partial x} \left(x^2 \frac{\partial^2 f}{\partial x^2} \right) = \frac{\partial }{\partial t} \left( \frac{\partial f}{\partial x} \right)
\end{split}
\end{equation}

By Clairut's theorem,

\begin{equation}
\frac{\partial}{\partial t} \left( \frac{\partial f}{\partial x} \right) = \frac{\partial}{\partial x} \left( \frac{\partial f}{\partial t} \right)
\end{equation}

And so the Euler condition further simplifies to

\begin{equation}
\frac{s^2}{2} \frac{\partial}{\partial x} \left(x^2 \frac{\partial^2 f}{\partial x^2} \right) = 0
\end{equation}

Which can be integrated with respect to $x$ as follows,

\begin{equation}
\frac{s^2 x^2}{2} \frac{\partial^2 f}{\partial x^2} \right) = k(t)
\label{eq:necCond}
\end{equation}

Where $k(t)$ is constant with respect to $x$ but may be some function of time.

## Sufficient condition

Equation \ref{eq:necCond} is the necessary condition to maximize equation \ref{eq:action}. The sufficient condition is

\begin{equation}
A(x) \bigr|_{\mathcal{L} = \mathcal{L}^*} - A(x + \psi(x)) \bigr|_{\mathcal{L} = \mathcal{L}^*} < 0
\end{equation}

Where $\psi(x)$ is an infinitely differentiable bell shaped function that vanishes at the boundaries of $x(t)$.

\begin{equation}
\psi(x(0)) = \psi(x(T)) = 0
\end{equation}

(See Lebedev and Cloud [-@lebedev2003calculus] for details.)

The optimized lagrangian $\mathcal{L}^*$ is found by evaluating the unoptimized lagrangian $\mathcal{L}$ in equation \ref{eq:lagrang} at the necessary condition in equation \ref{eq:necCond}, giving

\begin{equation}
\mathcal{L}^* = \frac{\partial f}{\partial x} \dot{x} + \frac{\partial f}{\partial t} + k(t)
\end{equation}

The lefthand side of the sufficient condition thus resolves to

\begin{equation}
A(x) \bigr|_{\mathcal{L} &= \mathcal{L}^*} - A(x + \psi(x)) \bigr|_{\mathcal{L} = \mathcal{L}^*} = \int_0^{\tau} \frac{\partial f}{\partial u} (\dot{x} + \dot{\psi}) - \frac{\partial f}{\partial x} \dot{x} + \frac{\partial f}{\partial t} \bigr|_{x + \psi} - \frac{\partial f}{\partial t} \bigr|_{x} \:dt \:\:;\:\:\: u = x + \psi
\end{equation}

But note that

\begin{equation}
\begin{split}
\frac{\partial f}{\partial x} \dot{x} &= \frac{\partial f}{\partial u} \frac{d u}{d x} \dot{x} \\
&= \frac{\partial f}{\partial u} \left(1 + \frac{d \psi}{d x} \right) \dot{x} \\
&= \frac{\partial f}{\partial u} \left(1 + \frac{\partial \psi}{\partial x} \right) \frac{dx}{dt} \\
&= \frac{\partial f}{\partial u} (\dot{x} + \dot{\psi})
\end{split}
\end{equation}

So that the previous equation reduces to

\begin{equation}
A(x) \bigr|_{\mathcal{L} &= \mathcal{L}^*} - A(x + \psi(x)) \bigr|_{\mathcal{L} = \mathcal{L}^*} = \int_0^{\tau} \frac{\partial f}{\partial t} \bigr|_{x + \psi} - \frac{\partial f}{\partial t} \bigr|_{x} \:dt
\label{eq:sufCond}
\end{equation}

To evaluate this, note that the necessary condition (equation \ref{eq:necCond}) can be rearranged as follows

\begin{equation}
\frac{s^2 x}{2} \frac{\partial^2 f}{\partial x^2} = \frac{k(t)}{x}
\end{equation}

Integrating both sides with respect to $\ln(x)$ then gives

\begin{equation}
\frac{s^2}{2} \frac{\partial f}{\partial x} = -\frac{k(t)}{x} + c(t)
\label{eq:dfdx}
\end{equation}

Where $c(t)$ is a constant of integration with respect to $x$, but might be some function of time. Integrating again with respect to $x$ gives

\begin{equation}
\frac{s^2}{2} f = -k(t) \ln(x) + c(t) x + b(t)
\label{eq:fStar}
\end{equation}

Where $b(t)$ is another constant of integration with respect to $x$. Subtracting equation \ref{eq:} from equation \ref{eq:} then gives

\begin{equation}
\frac{s^2}{2} \left( f - \frac{\partial f}{\partial x} x \right) = -k(t) (\ln(x) - 1) + b(t)
\end{equation}

Recalling equation \ref..., the lefthand side can be rewritten as follows.

\begin{equation}
\frac{s^2}{2 m} \left( \frac{\partial f}{\partial t} + k(t) \right) = -k(t) (\ln(x) - 1) + b(t)
\end{equation}

This can then be solved for $\partial f / \partial t$ as follows.

\begin{equation}
\frac{\partial f}{\partial t} = m \left[ -k(t) \left( \frac{2}{s^2} (\ln(x) - 1) + 1 \right) + \frac{2}{s^2} b(t) \right]
\label{eq:dfdt}
\end{equation}

Equation \ref{eq:sufCond} thus evaluates to

\begin{equation}
\int_0^{\tau} 2 \frac{m}{s^2} [-k(t) (\ln(x + \psi(x)) -  \ln(x)) ] \:dt
\end{equation}

Which is negative if $k(t) > 0$. The sufficient condition for maximum action is thus satisfied so long as $k(t) > 0$. To determine $k(t)$, recall equation \ref... and note that by the Black Scholes insight (equation ...), it can be reduced to

\ref{eq:bsrovpse}


\begin{equation}
\frac{\partial \mathcal{L}}{\partial x} = \frac{\partial^2 f}{\partial x^2} \dot{x} - m \frac{\partial^2 f}{\partial x^2}
\end{equation}

So that the Euler condition then becomes

\begin{equation}
\begin{split}
\frac{\partial}{\partial t} \left( \frac{\partial f}{\partial x} \right) + m \frac{\partial^2 f}{\partial x^2} x= 0 \\
\frac{\partial}{\partial t} \left( \frac{\partial f}{\partial x} \right) + m \frac{\partial}{\partial \ln(x)} \left( \frac{\partial f}{\partial x} \right) = 0
\end{split}
\end{equation}

<!-- Substituting $\tau = T - t$ for $t$ and multiplying through by $-1$, -->

<!-- \begin{equation} -->
<!-- \frac{\partial}{\partial \tau} \left( \frac{\partial f}{\partial x} \right) - m \frac{\partial}{\partial \ln(x)} \left( \frac{\partial f}{\partial x} \right) = 0 -->
<!-- \end{equation} -->

Factoring out $\partial f / \partial x$ and substituting $\tau$ for $T - t$,

\begin{equation}
\left( \frac{\partial}{\partial \tau} - m \frac{\partial}{\partial \ln(x)}   \right) \frac{\partial f}{\partial x} = 0
\label{eq:linWav}
\end{equation}

Multiplying through by $(\partial / \partial \tau + m \partial / \partial \ln(x))$,

\begin{equation}
\begin{split}
\left( \frac{\partial}{\partial \tau} + m \frac{\partial}{\partial \ln(x)}   \right) \left( \frac{\partial}{\partial \tau} - m \frac{\partial}{\partial \ln(x)}   \right) \frac{\partial f}{\partial x} &= 0 \\
\frac{\partial^2}{\partial \tau^2} \left( \frac{\partial f}{\partial x} \right) - m^2 \frac{\partial^2}{\partial \ln(x)^2}  \left( \frac{\partial f}{\partial x} \right) &= 0
\end{split}
\label{eq:wavEq1}
\end{equation}

Equation \ref{eq:wavEq1} is a wave equation that can be solved using D'Alambert's formula as follows. Letting $g(\ln(x), \tau) = \partial f / \partial x$ and $g_0 = g(\ln(x_0), 0)$,

\begin{equation}
g(\ln(x), \tau) = \frac{1}{2} ( g_0(\ln(x_0) + m \tau) + g_0(\ln(x_0) - m \tau)) + \frac{1}{2 m} \int_{\ln(x_0) - m \tau}^{\ln(x_0) + m \tau} \frac{\partial g}{\partial \tau} \bigr|_{\tau = 0} \: d \omega
\label{eq:dAlemb}
\end{equation}

By equation \ref{eq:linWav}, the integral can be rewritten

\begin{equation}
\begin{split}
\frac{1}{2 m} \int_{\ln(x_0) - m \tau}^{\ln(x_0) + m \tau} m \frac{\partial g}{\partial \ln(x)} \bigr|_{\tau = 0} \: d \omega &= \frac{1}{2} \int_{\ln(x_0) - m \tau}^{\ln(x_0) + m \tau} \frac{\partial g}{\partial \ln(x)} \bigr|_{\tau = 0} \: d \omega \\
&= \frac{1}{2} (g_0(\ln(x_0) + m \tau) - g_0(\ln(x_0) - m \tau))
\end{split}
\end{equation}

Substituting this back into D'Alambert's formula and simplifying,

\begin{equation}
g(\ln(x), \tau) = \frac{1}{2} g_0(\ln(x_0) + m \tau)
\end{equation}

The function $g_0$ is determined by evaluating equation \ref{eq:dfdx} at $\tau = 0$.

\begin{equation}
\begin{split}
g_0 &= \frac{\partial f}{\partial x} \bigr|_{\tau = 0} = \frac{2}{s^2} \left( - \frac{k(0)}{x_0} + c(0) \right) \\
&= -\frac{2}{s^2} k(0) e^{-\ln(x_0)} + \frac{2}{s^2} c(0)
\end{split}
\end{equation}

D'Alambert's formula thus resolves to

\begin{equation}
g(\ln(x), \tau) = -\frac{2}{s^2} \left( \frac{k(0)}{x_0} e^{-m \tau} + c(0) \right)
\label{eq:dAlembSol}
\end{equation}

Combining this with equation \ref{eq:dfdx} and solving for $k(\tau)$ then gives

\begin{equation}
k(\tau) = k(0) e^{-m \tau} + x_0(c(0) - c(\tau))
\end{equation}

Since $k(\tau)$ is only a function of $\tau$ and not of $x$, then it must be that $c(\tau)$ is a constant with respect to both $x$ and $\tau$, such that $c(\tau) = c(0)$. The expression for $k(\tau)$ thus reduces to

\begin{equation}
k(\tau) = k(0) e^{-m \tau}
\end{equation}

The constant $k(0)$ can be deduced by setting the righthand side of this expression equal to the lefthand side of the necessary condition in equation \ref{eq:necCond}.

\begin{equation}
k(0) e^{-m \tau} = \frac{s^2 x^2}{2} \frac{\partial^2 f}{\partial x^2}
\end{equation}

Since $f$ is not itself scaled by a constant, then it must be that the constant $k(0)$ corresponds to $\frac{s^2}{2}$, and hence

\begin{equation}
k(\tau) = \frac{s^2}{2} e^{-m \tau}
\label{eq:kTau}
\end{equation}

By which it follows that $k(\tau) > 0$. The sufficiency condition for maximum action (equation \ref{eq:sufCond}) is therefore fulfilled.

<!-- The integral in this expression can be resolved by differentiating equation \ref{eq:dfdt} with respect to $x$ and substituting $\tau$ for $t$.  -->

<!-- \begin{equation} -->
<!-- \frac{\partial}{\partial x} \left( \frac{\partial f}{\partial t} \right) = -2 \frac{m}{s^2} \frac{k(t)}{x} -->
<!-- \end{equation} -->

<!-- Recall that, by Clairut's theorem, -->

<!-- $$ -->
<!-- \frac{\partial}{\partial x} \left( \frac{\partial f}{\partial t} \right) = \frac{\partial}{\partial t} \left( \frac{\partial f}{\partial x} \right) -->
<!-- $$ -->

<!-- Hence -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \frac{\partial g}{\partial t} \bigr|_{t = 0} &= \frac{\partial}{\partial x} \left( \frac{\partial f}{\partial t} \right) \bigr|_{t = 0} \\ -->
<!-- &= -2 \frac{m}{s^2} \frac{k(0)}{x_0} -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- And the integral resolves to -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \int_{\ln(x_0) - m t}^{\ln(x_0) + m t} \frac{\partial g}{\partial t} \bigr|_{t = 0} \: d \omega &= -2 k(0) \frac{m}{s^2} \int_{\ln(x_0) - m t}^{\ln(x_0) + m t} \frac{1}{x_0} \: d x_0 \\ -->
<!-- &= 2 k(0) \frac{m}{s^2} (e^{mt} - e^{-mt}) \\ -->
<!-- &= 4 k(0) \frac{m}{s^2} \sinh(m t) -->
<!-- \end{split} -->
<!-- \label{eq:dAlembInt} -->
<!-- \end{equation} -->

<!-- Where $\sinh()$ is the hyperbolic sine function. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- g_0(\ln(x_0) + mt) &= - \frac{2}{s^2} k(0) e^{-\ln(x_0) - m t} + \frac{2}{s^2} c(0) \\ -->
<!-- g_0(\ln(x_0) - mt) &= - \frac{2}{s^2} k(0) e^{-\ln(x_0) + m t} + \frac{2}{s^2} c(0) \\ -->
<!-- \rightarrow g_0(\ln(x_0) + mt) + g_0(\ln(x_0) - mt) &= -\frac{2}{s^2} \left[ \frac{k(0)}{x_0} (e^{m \tau} + e^{-m \tau}) - 2 c(0) \right] \\ -->
<!-- &= -\frac{2}{s^2} \left( \cosh(m \tau) - c(0) \right) -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Where $\cosh()$ is the hyperbolic cosine function. Substituting this and equation \ref{eq:dAlembInt} into D'Alambert's formula (equation \ref{eq:dAlemb}) results in the following general solution for $g(\ln(x), t)$. -->

## Evaluating optimal option value

Having deduced the functional form of $k(\tau)$, the necessary condition in equation \ref{eq:necCond} can be more clearly expressed as follows.

\begin{equation}
\frac{\partial^2 f}{\partial x^2} x^2 = e^{-m \tau}
\label{eq:necCond2}
\end{equation}

An expression for the optimal option value can be deduced by solving the Black Scholes equation (\ref{eq:bsEq}) at the necessary condition as follows.

\begin{equation}
m f^* - m \frac{\partial f^*}{\partial x} x = \frac{\partial f}{\partial t} + \frac{s^2}{2} e^{-m \tau}
\end{equation}

Introducing the following change of variables,

\begin{equation}
\begin{split}
\tau &= T - t \\
f &= e^{-m \tau} y
\end{split}
\end{equation}

The previous equation reduces to

\begin{equation}
\begin{split}
- m e^{-m \tau} \frac{\partial y}{ \partial x} x &= -e^{-m \tau} \frac{\partial y}{\partial \tau} + \frac{s^2}{2} e^{-m \tau} \\
-m \frac{\partial y}{ \partial x} x &= -\frac{\partial y}{\partial \tau} + \frac{s^2}{2} \\
\frac{\partial y}{\partial \tau} - m \frac{\partial y}{ \partial \ln(x)} &= \frac{s^2}{2}
\end{split}
\end{equation}

Factoring out $y$ on the lefthand side, this can be rewritten as follows.

\begin{equation}
\left( \frac{\partial}{\partial \tau} - m \frac{\partial}{ \partial \ln(x)} \right) y = \frac{s^2}{2}
\label{eq:linWav2}
\end{equation}

Multiplying through by $(\partial / \partial \tau + m \partial / \partial \ln(x))$ then results in the following wave equation.

\begin{equation}
\begin{split}
\left( \frac{\partial}{\partial \tau} + m \frac{\partial}{ \partial \ln(x)} \right) \left( \frac{\partial}{\partial \tau} - m \frac{\partial}{ \partial \ln(x)} \right) y &= \left( \frac{\partial}{\partial \tau} + m \frac{\partial}{ \partial \ln(x)} \right) \frac{s^2}{2} \\
\frac{\partial^2 y}{\partial \tau^2} - m^2 \frac{\partial^2 y}{ \partial \ln(x)^2} &= 0
\end{split}
\end{equation}

The solution to this equation can be found by again using D'Alembert's formula.

\begin{equation}
y(\ln(x), \tau) = \frac{1}{2} ( y_0(\ln(x_0) + m \tau) + y_0^*(\ln(x_0) - m \tau)) + \frac{1}{2 m} \int_{\ln(x_0) - m \tau}^{\ln(x_0) + m \tau} \frac{\partial y}{\partial \tau} \: d \omega
\end{equation}

By equation \ref{eq:linWav2}, the integral can be rewritten

\begin{equation}
\begin{split}
\frac{1}{2 m} \int_{\ln(x_0) - m \tau}^{\ln(x_0) + m \tau} m \frac{\partial y}{\partial \ln(x)} + \frac{s^2}{2} \: d \omega &= \frac{1}{2} \int_{\ln(x_0) - m \tau}^{\ln(x_0) + m \tau} \frac{\partial y}{\partial \ln(x)} \: d \omega + \frac{s^2}{4m} \int_{\ln(x_0) - m \tau}^{\ln(x_0) + m \tau} \: d \omega \\
&= \frac{1}{2} (y_0(\ln(x_0) + m \tau) - y_0^*(\ln(x_0) - m \tau)) + \frac{s^2}{2} \tau
\end{split}
\end{equation}

Substituting back into D'Alambert's formula and simplifying,

\begin{equation}
y(\ln(x), \tau) = y_0(\ln(x_0) + m \tau) + \frac{s^2}{2} \tau
\end{equation}

To resolve the function $y_0$, first note that equation \ref{eq:dfdx} can be simplified now that the form of $k(\tau)$ is known (equation \ref{eq:kTau}).

\begin{equation}
\frac{\partial f}{\partial x} = \frac{2}{s^2} c - \frac{e^{-m \tau}}{x}
\label{eq:dfdxB}
\end{equation}

If $f$ has the form in equation \ref{eq:ov}, then $0 \leq \partial f / \partial x \leq 1$, which requires $c = s^2 / 2$; and so the equation further simplifies to

\begin{equation}
\frac{\partial f}{\partial x} = 1 - \frac{e^{-m \tau}}{x}
\label{eq:dfdxB}
\end{equation}

The integral of this equation with respect to $x$ (equation \ref{eq:fStar}) likewise simplifies to

\begin{equation}
f = x - e^{-m \tau} \ln(x) + b(\tau)
\end{equation}

Therefore,

\begin{equation}
\begin{split}
y_0 = [e^{m \tau} f ]_{\tau = 0} = x_0 - \ln(x_0) + b(0) \\
\rightarrow y_0(\ln(x_0) + m \tau) = x_0 e^{m \tau} - \ln(x_0) - m \tau + b(0)
\end{split}
\end{equation}

And so D'Alambert's formular resolves to

\begin{equation}
\begin{split}
y(\ln(x), \tau) &= x_0 e^{m \tau} - \ln(x_0) - m \tau + b(0) + \frac{s^2}{2} \tau \\
&= x_0 e^{m \tau} - \ln(x_0) - \left(m - \frac{s^2}{2} \right) \tau + b(0) \\
&= E(x_{\tau}) - E(\ln(x_{\tau})) + b(0)
\end{split}
\end{equation}

And the optimal option value is thus

\begin{equation}
f(\ln(x_0), \tau) = e^{-m \tau} y(\ln(x), \tau) = e^{-m \tau} (E(x_{\tau}) - E(\ln(x_{\tau})) + b(0))
\end{equation}

To determine the constant $b(0)$, differentiate this equation with respect to time.

\begin{equation}
\frac{\partial f}{\partial t} = m f - m x_0 + e^{-m \tau} \left(m - \frac{s^2}{2} \right)
\end{equation}

Now substitute the functional form of $k(\tau)$ (equation \ref{eq:kTau}) into equation \ref{eq:dfdt} and rearrange as follows.

\begin{equation}
\frac{\partial f}{\partial t} = -e^{-m \tau} \left( m \ln(x) - \left( m - \frac{s^2}{2} \right)  \right) + 2 \frac{m}{s^2} b(t)
\end{equation}

Setting the last two equations equal and solving for $b(\tau)$ gives

\begin{equation}
b(\tau) = -\frac{s^2}{2} e^{-m \tau} \left( m - \frac{s^2}{2} \right) \tau
\end{equation}

Therefore, $b(0) = 0$, and the optimal option value equation reduces to

\begin{equation}
f(\ln(x), \tau) = e^{-m \tau} (E(x_{\tau}) - E(\ln(x_{\tau})))
\end{equation}

## Optimal control

With $k(\tau)$ in hand, the derivative $\partial f / \partial x$ (equation \ref{eq:dAlembSol}) may be more clearly expressed as follows.

\begin{equation}
\frac{\partial f^*}{\partial x} = \frac{2}{s^2} c - \frac{e^{-m \tau}}{x_0}
\end{equation}

If $f$ is a 1-fold option, then this may be rewritten as follows.

\begin{equation}
\Phi(\delta_1 + s_0 \sqrt{\tau_1}) = \frac{2}{s_0^2} c - \frac{e^{-m \tau_1}}{x_0}
\end{equation}

Since $0 < \Phi(\delta_1 + s_0 \sqrt{\tau_1}) < 1$, it must be that $c = s_0^2 / 2$, and so the equation simplifies further to

\begin{equation}
\Phi(\delta_1 + s_0 \sqrt{\tau_1}) = 1 - \frac{e^{-m \tau_1}}{x_0}
\end{equation}

At the project level, the variables in this equation---time horizon $\tau_1$, risk $s_0$, expected impact $x_0 e^{m \tau}$, and exercise price K_1---are usually exogenously given. However, at the program level, it may be that the donor has discretion over some of these variables, in particular, the time horizon, impacts, and guaranteed value. It is straightforward to show that Equation \ref{eq:} is the same for a program level option as it is for a 








# Discussion and conclusion

Simpler form, more tractable


```{r}

OVfun <- function(X0, K, tau, mm, s, r, output = "OV"){
  
  d2 <- (log(X0 / K) + (mm - s^2 / 2) * tau) / (s * sqrt(tau))
  d1 <- d2 + s * sqrt(tau)
  N1 <- pnorm(d1)
  N2 <- pnorm(d2)
  
  OV <- exp((mm - r) * tau) * X0 * N1 - exp(-r * tau) * K * N2

    if(output == "OV"){
    out <- OV
  }
  
  if(output == "N2"){
    out <- N2
  }
  
  if(output == "N1"){
    out <- N1
  }

  return(out)
}
#------------------------
OVstar <- function(X0, K = NULL, tau, mm, s, r){
  if(is.null(K)){
    fStar <- exp(-r * tau) * (exp(mm * tau) * X0 - log(X0) - (mm - s^2 / 2) * tau)
  }else{
    fStar <- exp(-r * tau) * (exp(mm * tau) * X0 / K - log(X0 / K) - (mm - s^2 / 2) * tau)
  }
  
  return(fStar)
}
#------------------------

slackFun <- function(K, X0, tau, mm, s){
  d1 <- (log(X0 / K) + (mm + s^2 / 2) * tau) / (s * sqrt(tau))
  N1 <- pnorm(d1)
  slack <- N1 - 1 + exp(- mm * tau) / X0
  return(slack)
}

#------------------------

slackFun2 <- function(K, X0, s, tau, mm, r){
  fStar <- OVstar(X0, K, tau, mm, s, r)
  f <- OVfun(X0, K, tau, mm, s, r, output = "OV")
  slack <- fStar - f
  return(slack)

}

# slackFun2 <- function(K, X0, s, tau, mm){
#   d1 <- (log(X0 / K) + (mm + s^2 / 2) * tau) / (s * sqrt(tau))
#   n1 <- dnorm(d1)
#   #d2fdx2 <- n1 / (X0 * s * sqrt(tau))
#   slack <- X0 * n1 - s * sqrt(tau) * exp(- mm * tau)
#   return(slack)
# }

#=======================================================================
library(tidyverse)
#mm <- 0.01
r <- mm
mm <- seq(0.005, 0.1, length.out = 50)
cv <- 5
s <- cv * mm
X0 <- 10
tau <- 35
#tau <- seq(5, 50, 1)
#K <- seq(0.1, 2, length.out = 20) * X0
K <- X0 * .90
# Kguess <- c(K[1], K[length(K)])
# Kstar <- rootSolve::uniroot.all(slackFun, interval = Kguess, X0 = X0, tau = tau, mm = mm, s = s)
# Kstar2 <- rootSolve::uniroot.all(slackFun2, interval = Kguess, X0 = X0, s = s, tau = tau, mm = mm, r = r)

fStar <- OVstar(X0, K, tau, mm, s, r)
f <- OVfun(X0, K, tau, mm, s, r, output = "OV")
d <- fStar - f

df_plot <- data.frame(d, mm)
gg <- ggplot(df_plot, aes(x = mm, y = d))
gg <- gg + geom_line(lwd = 1)
gg <- gg + geom_hline(yintercept = 0, color = "red")
#gg <- gg + geom_hline(yintercept = Astar, color = "green")
# gg <- gg + geom_vline(xintercept = Kstar2, color = "green")
# gg <- gg + geom_vline(xintercept = X0, color = "orange")
gg






# fT <- OVfun(X0, K, tau = tau, mm, s, output = "OV")
# f0 <- OVfun(X0, K, tau = 0, mm, s, output = "OV")
# A <- fT - f0
# #Astar <- (exp(-mm * tau) - 1) * log(X0) - exp(-mm * tau) * (mm - s^2 / 2) * tau
# #max(A) / Astar
# 
# df_plot <- data.frame(A, K)
# gg <- ggplot(df_plot, aes(x = K, y = A))
# gg <- gg + geom_line(lwd = 1)
# gg <- gg + geom_hline(yintercept = 0, color = "red")
# #gg <- gg + geom_hline(yintercept = Astar, color = "green")
# gg <- gg + geom_vline(xintercept = Kstar, color = "green")
# gg


slackFun(K, X0, s, tau, mm)
slackFun2(K, X0, s, tau, mm)














```



# References {-}
<!-- References {#references .unnumbered} -->

<div id="refs"></div>

\pagebreak

# Appendix: Derivation of the ROV formula through straightforward integration

<!-- If $u$ is a random variable with lognormal density function $f(u)$, then the definite integral of $u f(u)$ over a specific domain $(\underline{u}, \bar{u})$, where $\underline{u}$ is the lower and $\bar{u}$ the upper bound of the domain (and where at least one of the bounds is finite), may be expressed as follows. -->

<!-- \begin{equation} -->
<!-- \int_{\underline{u}}^{\bar{u}} u f(u) \: du = \mu_u (\Phi(\bar{z}) - \Phi(\underline{z})) -->
<!-- \label{eq:hullsResult} -->
<!-- \end{equation} -->

<!-- Where $\mu_u$ is the mean of $u$, defined -->

<!-- \begin{equation} -->
<!-- \mu_u = e^{m_u + s_u^2 / 2} \:\:;\:\:\: m_u = E(\ln(u)), \:\: s_u^2 = Var(\ln(u)) -->
<!-- \end{equation} -->

<!-- And where $\Phi(t)$ is the standard normal cumulative distribution function, defined -->

<!-- \begin{equation} -->
<!-- \Phi(\tau) = \frac{1}{\sqrt{2 \pi}} \int_{-\infty}^{\tau} e^{-t^2 / 2} \: dt -->
<!-- \end{equation} -->

<!-- And where $\bar{z}$ and $\underline{z}$ are defined as follows. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \bar{z} &= \frac{\ln(\bar{u}) - m_u}{s_u} - s_u \\ -->
<!-- \underline{z} &= \frac{\ln(\underline{u}) - m_u}{s_u} - s_u -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- _Proof:_ -->

By definition,

\begin{equation}
E[max(x_T - K, 0)] = \int_{K}^{\infty} (x_T - K) f(x_T) \: dx_T
\end{equation}

Where $f(x_T)$ is the probability density function of the random variable $x_T$. If $\ln(x_T)$ is normally distributed with mean $\nu$ and variance $\omega^2$, then 

\begin{equation}
E[x_T] = e^{\nu + \frac{\omega^2}{2}}
\label{eq:muXT}
\end{equation}

and

\begin{equation}
f(x_T) = \frac{1}{x_T \omega} \phi \left(\frac{\ln(x_T) - \nu}{\omega} \right)
\end{equation}

Where $\phi()$ stands for the standard normal probability density function.

Now, introducing a change of variables,

\begin{equation}
u = \frac{\ln(x_T) - \nu}{\omega}
\label{eq:subThis1}
\end{equation}

Such that

\begin{equation}
\frac{du}{d x_T} = \frac{1}{x_T \omega}\: \rightarrow \: d x_T = x_T \omega du
\label{eq:subThis2}
\end{equation}

The definition at the top can be rewritten as follows.

\begin{equation}
\begin{split}
E[max(x_T - K, 0)] &= \int_{\frac{\ln(K) - \nu}{\omega}}^{\infty} (e^{u \omega + \nu} - K) \phi(u) \: du \\
&= \int_{\frac{\ln(K) - \nu}{\omega}}^{\infty} e^{u \omega + \nu} \phi(u) \: du - K \int_{\frac{\ln(K) - \nu}{\omega}}^{\infty} \phi(u) \: du \\
&= \int_{\frac{\ln(K) - \nu}{\omega}}^{\infty} e^{u \omega + \nu} \phi(u) \: du - K \Phi \left(-\frac{\ln(K) - \nu}{\omega} \right)
\end{split}
\end{equation}

Where $\Phi()$ is the standard normal cumulative distribution function.
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \phi(u) &= \frac{1}{\sqrt{2 \pi}} e^{-\frac{u^2}{2}} \\ -->
<!-- \Phi(a) &= \frac{1}{\sqrt{2 \pi}} \int_{-infty}^{a} e^{-\frac{u^2}{2}} \: du -->
<!-- \end{split} -->
<!-- \end{equation} -->

The remaining integral on the righthand side of the definition resolves as follows.

\begin{equation}
\begin{split}
\int_{\frac{\ln(K) - \nu}{\omega}}^{\infty} e^{u \omega + \nu} \phi(u) \: du &= \frac{1}{\sqrt{2 \pi}} \int_{\frac{\ln(K) - \nu}{\omega}}^{\infty} e^{u \omega + \nu -\frac{u^2}{2}} \: du \\
&= \frac{1}{\sqrt{2 \pi}} \int_{\frac{\ln(K) - \nu}{\omega}}^{\infty} e^{-1 / 2 (u^2 - 2 u \omega - 2 \nu)} \: du \\
&= \frac{1}{\sqrt{2 \pi}} \int_{\frac{\ln(K) - \nu}{\omega}}^{\infty} e^{-\frac{(u^2 - \omega)^2}{2} + \nu + \frac{\omega^2}{2}} \: du \\
&= \frac{1}{\sqrt{2 \pi}} \int_{\frac{\ln(K) - \nu}{\omega}}^{\infty} e^{-\frac{(u^2 - \omega)^2}{2}} e^{\nu + \frac{\omega^2}{2}} \: du \\
&= e^{\nu + \frac{\omega^2}{2}} \frac{1}{\sqrt{2 \pi}} \int_{\frac{\ln(K) - \nu}{\omega}}^{\infty} e^{-\frac{(u^2 - \omega)^2}{2}} \: du \\
&= \frac{E[x_T]}{\sqrt{2 \pi}} \int_{\frac{\ln(K) - \nu}{\omega}}^{\infty} e^{-\frac{(u^2 - \omega)^2}{2}} \: du
\end{split}
\end{equation}


<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- &= \frac{E[x_T]}{\sqrt{2 \pi}} \int_{\frac{\ln(K) - \nu}{\omega}}^{\infty} e^{-\frac{(u^2 - \omega)^2}{2}} \: du \\ -->
<!-- &= E[x_T] \Phi(- \frac{\ln(K) - \nu}{\omega} + \omega) -->
<!-- \end{split} -->
<!-- \end{equation} -->

The definition may now be rewritten as follows.

\begin{equation}
E[max(x_T - K, 0)] = E[x_T] \Phi \left(- \frac{\ln(K) - \nu}{\omega} + \omega \right) - K \Phi \left(-\frac{\ln(K) - \nu}{\omega} \right)
\end{equation}

Note that \ref{eq:muXT} can be rearranged into an expression for $\nu$.

\begin{equation}
\nu = \ln(E[x_T]) - \omega^2 / 2
\label{eq:subThis1}
\end{equation}

Substituting this for $\nu$ in the definition gives

\begin{equation}
E[max(x_T - K, 0)] = E[x_T] \Phi \left(\frac{\ln(E[x_T] / K) + \omega^2 / 2}{\omega} \right) - K \Phi \left(-\frac{\ln(E[x_T] / K) - \omega^2 / 2}{\omega} \right)
\end{equation}

If $x_t$ $(0 < t \leq T)$ follows a geometric Brownian motion, then $E[x_T] \bigr|_t = x_t e^{m \tau}$, and the variance of $\ln(x_t)$ is $s^2 \tau$, where $\tau = T - t$. (See Hull [-@hull9thEdition] for details.)

Substituting these expressions for $E[x_T]$ and $\omega$, the definition can again be rewritten as follows.

\begin{equation}
E[max(x_T - K, 0)]\bigr|_t = x_t e^{m \tau} \Phi \left(\frac{\ln(x_t / K) + (m + s^2 / 2) \tau}{s \sqrt{\tau}} \right) - K \Phi \left(\frac{\ln(x_t / K) + (m - s^2 / 2) \tau}{s \sqrt{\tau}} \right)
\end{equation}

Or, more compactly,

\begin{equation}
E[max(x_T - K, 0)]\bigr|_t = x_t e^{m \tau} \Phi(\delta + s \sqrt{\tau}) - K \Phi(\delta)
\end{equation}

Where

\begin{equation}
\delta = \frac{\ln(x_t / K) + (m - s^2 / 2) \tau}{s \sqrt{\tau}}
\end{equation}

Multiplying this by the discount factor then gives

\begin{equation}
e^{-r \tau} E[max(x_T - K, 0)]\bigr|_t = x_t e^{(m - r) \tau} \Phi(\delta + s \sqrt{\tau}) - e^{-r \tau} K \Phi(\delta)
\end{equation}

This is the ROV formula in equation \ref{eq:rov}.

$\blacksquare$

For a reference, see the appendix to chapter 15 in Hull [-@hull9thEdition].

<!-- [Many practitioners might find the real options approach compelling on a conceptual level, but then come to view it as a "black box" [inviting misuse/abuse] once they delve into the computational details. [In Figure \ref one sees how easy it is for a naive/unscrupulous practitioner to unwittingly/deliberately inflate the value of a worthless project through misspecification of the uncertainty parameter $s$.]] -->

<!-- In any modeling exercise there is always a tradeoff between realism and expediency. In academic contexts, there is a premium on the realism end of the spectrum, while in practical contexts, the premium is on expediency.  -->

<!-- Much of this complexity can be traced back to an entrenched perception that the assumption of lognormal NPV is unrealistic. Trigeorgis calls numerical methods the "bitter pill" that all serious ROV practitioners must face [].  real option value  two sources in particular: 1) An attempt at adapting the efficient market hypothesis from financial contexts to far-from-market real options contexts; and 2) a rejection of the lognormal assumption,  insistence on sophisticated stochastic models. -->

<!-- Here i show there is no need to adapt the no-arbitrage argument to real options contexts. -->
<!-- bitter pill...partly rooted in/Inherited from financial contexts, where the analogous assumption of lognormal security returns is widely considered to be naive.    -->

<!-- "En pro:" -->

<!-- McGrath and MacMillan [@mcgrath2000assessing] -->

<!-- Newton, Paxson, and Widdicks [@newton2004real] -->

<!-- Trigeorgis [@trigeorgis1993real] -->

<!-- Hayes and Garvin [@hayes1982managing] -->

<!-- Doctor, Newton, and Pearson [@doctor2001managing] -->

<!-- "En contra:" -->

<!-- Block [@block2007real] -->

<!-- Horn, Kjrland, Molnr, and Steen [@horn2015use] -->

<!-- Triantis [@triantis2005realizing] -->

<!-- Driouchi and Bennett [@driouchi2012real] -->

<!-- I then show how the necessary condition can be used to optimize real option time horizons, risk levels, expected returns, or exercise costs, when these are discretionary. I close with a brief discussion of how the derived expression for maximum option value can simplify real option funding decision-making processes. A potentially  Real option value is often promoted as an appealing alternative to the conventional net present value approach to project appraisal on the premise that real option value may be positive even when net present value is negative. Here I demonstrate that real option value must always be less than net present value.  The maximum option value formula is valid for compound options too, or any function satisfying the Black-Scholes differential equation. -->


<!-- brief defense of the lognormal assumption.... Interest in real options is increasingly academic, perhaps partly because of these reasons. The present paper may [alleviate this by presenting a simpler model. By considering the envelope, we consider the very best case scenario; and it's much simpler to manipulate, evaluate] -->

<!-- * Risk free assumption not necessary -->

<!-- * Motivating context in agricultural research for development, far from market...but wide applicability. -->
